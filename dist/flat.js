!function(t,e){"function"==typeof define&&define.amd?define(function(){return e(t)}):"object"==typeof exports?module.exports=e:t.echo=e(t)}(this,function(t){"use strict";var e,n,o,r,c,a={},u=function(){},d=function(t,e){if(function(t){return null===t.offsetParent}(t))return!1;var n=t.getBoundingClientRect();return n.right>=e.l&&n.bottom>=e.t&&n.left<=e.r&&n.top<=e.b},i=function(){!r&&n||(clearTimeout(n),n=setTimeout(function(){a.render(),n=null},o))};return a.init=function(n){var d=(n=n||{}).offset||0,l=n.offsetVertical||d,f=n.offsetHorizontal||d,s=function(t,e){return parseInt(t||e,10)};e={t:s(n.offsetTop,l),b:s(n.offsetBottom,l),l:s(n.offsetLeft,f),r:s(n.offsetRight,f)},o=s(n.throttle,250),r=!1!==n.debounce,c=!!n.unload,u=n.callback||u,a.render(),document.addEventListener?(t.addEventListener("scroll",i,!1),t.addEventListener("load",i,!1)):(t.attachEvent("onscroll",i),t.attachEvent("onload",i))},a.render=function(){for(var n,o,r=document.querySelectorAll("img[data-echo], [data-echo-background]"),i=r.length,l={l:0-e.l,t:0-e.t,b:(t.innerHeight||document.documentElement.clientHeight)+e.b,r:(t.innerWidth||document.documentElement.clientWidth)+e.r},f=0;f<i;f++)o=r[f],d(o,l)?(c&&o.setAttribute("data-echo-placeholder",o.src),null!==o.getAttribute("data-echo-background")?o.style.backgroundImage="url("+o.getAttribute("data-echo-background")+")":o.src=o.getAttribute("data-echo"),c||(o.removeAttribute("data-echo"),o.removeAttribute("data-echo-background")),u(o,"load")):c&&(n=o.getAttribute("data-echo-placeholder"))&&(null!==o.getAttribute("data-echo-background")?o.style.backgroundImage="url("+n+")":o.src=n,o.removeAttribute("data-echo-placeholder"),u(o,"unload"));i||a.detach()},a.detach=function(){document.removeEventListener?t.removeEventListener("scroll",i):t.detachEvent("onscroll",i),clearTimeout(n)},a});
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.GlslCanvas=e()}(this,function(){"use strict";function t(t,e,i){var r=t;return l(e)?(i=e,"string"==typeof t&&(r={uri:t})):r=v(e,{uri:t}),r.callback=i,r}function e(e,r,n){return i(r=t(e,r,n))}function i(t){function i(t){return clearTimeout(u),t instanceof Error||(t=new Error(""+(t||"Unknown XMLHttpRequest Error"))),t.statusCode=0,o(t,p)}function r(){if(!l){var e;clearTimeout(u),e=t.useXDR&&void 0===a.status?200:1223===a.status?204:a.status;var i=p,r=null;return 0!==e?(i={body:function(){var t=void 0;if(t=a.response?a.response:a.responseText||function(t){if("document"===t.responseType)return t.responseXML;var e=t.responseXML&&"parsererror"===t.responseXML.documentElement.nodeName;return""!==t.responseType||e?null:t.responseXML}(a),m)try{t=JSON.parse(t)}catch(t){}return t}(),statusCode:e,method:f,headers:{},url:h,rawRequest:a},a.getAllResponseHeaders&&(i.headers=g(a.getAllResponseHeaders()))):r=new Error("Internal XMLHttpRequest Error"),o(r,i,i.body)}}if(void 0===t.callback)throw new Error("callback argument missing");var n=!1,o=function(e,i,r){n||(n=!0,t.callback(e,i,r))},a=t.xhr||null;a||(a=t.cors||t.useXDR?new e.XDomainRequest:new e.XMLHttpRequest);var s,l,u,h=a.url=t.uri||t.url,f=a.method=t.method||"GET",c=t.body||t.data,d=a.headers=t.headers||{},v=!!t.sync,m=!1,p={body:void 0,headers:{},statusCode:0,method:f,url:h,rawRequest:a};if("json"in t&&!1!==t.json&&(m=!0,d.accept||d.Accept||(d.Accept="application/json"),"GET"!==f&&"HEAD"!==f&&(d["content-type"]||d["Content-Type"]||(d["Content-Type"]="application/json"),c=JSON.stringify(!0===t.json?c:t.json))),a.onreadystatechange=function(){4===a.readyState&&setTimeout(r,0)},a.onload=r,a.onerror=i,a.onprogress=function(){},a.onabort=function(){l=!0},a.ontimeout=i,a.open(f,h,!v,t.username,t.password),v||(a.withCredentials=!!t.withCredentials),!v&&t.timeout>0&&(u=setTimeout(function(){if(!l){l=!0,a.abort("timeout");var t=new Error("XMLHttpRequest timeout");t.code="ETIMEDOUT",i(t)}},t.timeout)),a.setRequestHeader)for(s in d)d.hasOwnProperty(s)&&a.setRequestHeader(s,d[s]);else if(t.headers&&!function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}(t.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in t&&(a.responseType=t.responseType),"beforeSend"in t&&"function"==typeof t.beforeSend&&t.beforeSend(a),a.send(c||null),a}function r(t,e,i){var r=t.gl,n=r.createShader(i);return r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(R=r.getShaderInfoLog(n),console.error("*** Error compiling shader "+n+":"+R),t.trigger("error",{shader:n,source:e,type:i,error:R}),r.deleteShader(n),null)}function n(t){return 0==(t&t-1)}function o(t){var e=new Set;return Object.assign(t,{on:function(t,i){var r={};r[t]=i,e.add(r)},off:function(t,i){if(i){var r={};r[t]=i,e.delete(r)}else{var n=!0,o=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var u=s.value,h=!0,f=!1,c=void 0;try{for(var d,g=Object.keys(u)[Symbol.iterator]();!(h=(d=g.next()).done);h=!0)if(d.value===t)return void e.delete(u)}catch(t){f=!0,c=t}finally{try{!h&&g.return&&g.return()}finally{if(f)throw c}}}}catch(t){o=!0,a=t}finally{try{!n&&l.return&&l.return()}finally{if(o)throw a}}}},listSubscriptions:function(){var t=!0,i=!1,r=void 0;try{for(var n,o=e[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var a=n.value;console.log(a)}}catch(t){i=!0,r=t}finally{try{!t&&o.return&&o.return()}finally{if(i)throw r}}},subscribe:function(t){e.add(t)},unsubscribe:function(t){e.delete(t)},unsubscribeAll:function(){e.clear()},trigger:function(t){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];var o=!0,a=!1,s=void 0;try{for(var l,u=e[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;"function"==typeof h[t]&&h[t].apply(h,b(r))}}catch(t){a=!0,s=t}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}}})}var a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},s="undefined"!=typeof window?window:void 0!==a?a:"undefined"!=typeof self?self:{},l=function(t){var e=u.call(t);return"[object Function]"===e||"function"==typeof t&&"[object RegExp]"!==e||"undefined"!=typeof window&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)},u=Object.prototype.toString,h=function(t,e){return function(t,e){(e=t.exports=function(t){return t.replace(/^\s*|\s*$/g,"")}).left=function(t){return t.replace(/^\s*/,"")},e.right=function(t){return t.replace(/\s*$/,"")}}(e={exports:{}},e.exports),e.exports}(),f=function(t,e,i){if(!l(e))throw new TypeError("iterator must be a function");arguments.length<3&&(i=this),"[object Array]"===c.call(t)?function(t,e,i){for(var r=0,n=t.length;r<n;r++)d.call(t,r)&&e.call(i,t[r],r,t)}(t,e,i):"string"==typeof t?function(t,e,i){for(var r=0,n=t.length;r<n;r++)e.call(i,t.charAt(r),r,t)}(t,e,i):function(t,e,i){for(var r in t)d.call(t,r)&&e.call(i,t[r],r,t)}(t,e,i)},c=Object.prototype.toString,d=Object.prototype.hasOwnProperty,g=function(t){if(!t)return{};var e={};return f(h(t).split("\n"),function(t){var i=t.indexOf(":"),r=h(t.slice(0,i)).toLowerCase(),n=h(t.slice(i+1));void 0===e[r]?e[r]=n:function(t){return"[object Array]"===Object.prototype.toString.call(t)}(e[r])?e[r].push(n):e[r]=[e[r],n]}),e},v=function(){for(var t={},e=0;e<arguments.length;e++){var i=arguments[e];for(var r in i)m.call(i,r)&&(t[r]=i[r])}return t},m=Object.prototype.hasOwnProperty,p=e;e.XMLHttpRequest=s.XMLHttpRequest||function(){},e.XDomainRequest="withCredentials"in new e.XMLHttpRequest?e.XMLHttpRequest:s.XDomainRequest,function(t,e){for(var i=0;i<t.length;i++)e(t[i])}(["get","put","post","patch","head","delete"],function(r){e["delete"===r?"del":r]=function(e,n,o){return(n=t(e,n,o)).method=r.toUpperCase(),i(n)}});var y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E=(function(){function t(t){function e(r,n){try{var o=t[r](n),a=o.value;a instanceof function(t){this.value=t}?Promise.resolve(a.value).then(function(t){e("next",t)},function(t){e("throw",t)}):i(o.done?"return":"normal",o.value)}catch(t){i("throw",t)}}function i(t,i){switch(t){case"return":r.resolve({value:i,done:!0});break;case"throw":r.reject(i);break;default:r.resolve({value:i,done:!1})}(r=r.next)?e(r.key,r.arg):n=null}var r,n;this._invoke=function(t,i){return new Promise(function(o,a){var s={key:t,arg:i,resolve:o,reject:a,next:null};n?n=n.next=s:(r=n=s,e(t,i))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(t){return this._invoke("next",t)},t.prototype.throw=function(t){return this._invoke("throw",t)},t.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),T=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),b=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},R="",_='\n\tThis page requires a browser that supports WebGL.<br/>\n\t<a href="http://get.webgl.org">Click here to upgrade your browser.</a>\n',x='\n\tIt does not appear your computer can support WebGL.<br/>\n\t<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>\n',w=1,A=2,S=function(){function t(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};E(this,t),o(this),this.gl=e,this.texture=e.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=i,this.source=null,this.sourceType=null,this.loading=null,this.setData(1,1,new Uint8Array([0,0,0,255]),{filtering:"linear"}),this.setFiltering(r.filtering),this.load(r)}return T(t,[{key:"destroy",value:function(){this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,this.valid=!1)}},{key:"bind",value:function(e){this.valid&&("number"==typeof e&&t.activeUnit!==e&&(this.gl.activeTexture(this.gl.TEXTURE0+e),t.activeUnit=e),t.activeTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),t.activeTexture=this.texture))}},{key:"load",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=null,"string"==typeof t.url?void 0!==this.url&&t.url===this.url||this.setUrl(t.url,t):t.element?this.setElement(t.element,t):t.data&&t.width&&t.height&&this.setData(t.width,t.height,t.data,t)}},{key:"setUrl",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.valid)return this.url=t,this.source=this.url,this.sourceType="url",this.loading=new Promise(function(r,n){var o=t.split(".").pop().toLowerCase(),a="ogv"===o||"webm"===o||"mp4"===o,s=void 0;a?((s=document.createElement("video")).autoplay=!0,i.filtering="nearest"):s=new Image,s.onload=function(){try{e.setElement(s,i)}catch(t){console.log("Texture '"+e.name+"': failed to load url: '"+e.source+"'",t,i)}r(e)},s.onerror=function(t){console.log("Texture '"+e.name+"': failed to load url: '"+e.source+"'",t,i),r(e)},/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&"data:"===e.source.slice(0,5)||(s.crossOrigin="anonymous"),s.src=e.source,a&&e.setElement(s,i)}),this.loading}},{key:"setData",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.width=t,this.height=e,this.source=i,this.sourceType="data",this.update(r),this.setFiltering(r),this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(t,e){var i=this,r=t;if("string"==typeof t&&(t=document.querySelector(t)),t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement)this.source=t,this.sourceType="element",t instanceof HTMLVideoElement?(t.addEventListener("canplaythrough",function(){i.intervalID=setInterval(function(){i.update(e)},15)},!0),t.addEventListener("ended",function(){t.currentTime=0,t.play()},!0)):this.update(e),this.setFiltering(e);else{var n="the 'element' parameter (`element: "+JSON.stringify(r)+"`) must be a CSS ";n+="selector string, or a <canvas>, <image> or <video> object",console.log("Texture '"+this.name+"': "+n,e)}return this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.valid&&(this.bind(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==t.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),"element"===this.sourceType&&(this.source instanceof HTMLCanvasElement||this.source instanceof HTMLVideoElement||this.source instanceof HTMLImageElement&&this.source.complete)?(this.source instanceof HTMLVideoElement?(this.width=this.source.videoWidth,this.height=this.source.videoHeight):(this.width=this.source.width,this.height=this.source.height),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source)):"data"===this.sourceType&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source),this.trigger("loaded",this))}},{key:"setFiltering",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.valid){this.powerOf2=n(this.width)&&n(this.height);var e=this.powerOf2?"mipmap":"linear";this.filtering=t.filtering||e;var i=this.gl;this.bind(),this.powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t.TEXTURE_WRAP_S||t.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t.TEXTURE_WRAP_T||t.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),"mipmap"===this.filtering?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.generateMipmap(i.TEXTURE_2D)):"linear"===this.filtering?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):"nearest"===this.filtering&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST))):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),"mipmap"===this.filtering&&(this.filtering="linear"),"nearest"===this.filtering?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)))}}}]),t}();S.getMaxTextureSize=function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)},S.activeUnit=-1;var L=function(){function t(e,i,r){var n=this;E(this,t),o(this),i=i||{},r=r||{},this.width=e.clientWidth,this.height=e.clientHeight,this.canvas=e,this.gl=void 0,this.program=void 0,this.textures={},this.uniforms={},this.vbo={},this.isValid=!1,this.vertexString=i.vertexString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    v_texcoord = a_texcoord;\n}\n",this.fragmentString=i.fragmentString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 v_texcoord;\n\nvoid main(){\n    gl_FragColor = vec4(0.0);\n}\n";var a=function(t,e,i){function r(e){var i=t.parentNode;i&&(i.innerHTML=function(t){return'\n<table style="background-color: #8CE; width: 100%; height: 100%;"><tr>\n<td align="center">\n<div style="display: table-cell; vertical-align: middle;">\n<div style="">'+t+"</div>\n</div>\n</td></tr></table>\n"}(e))}function n(t,e){"function"==typeof i?i(t):r(e)}if(!window.WebGLRenderingContext)return n(w,_),null;var o=function(t,e){for(var i=["webgl","experimental-webgl"],r=null,n=0;n<i.length;++n)try{r=t.getContext(i[n],e)}catch(t){if(r)break}return r}(t,e);return o?o.getExtension("OES_standard_derivatives"):n(A,x),o}(e,i,r.onError);if(a){if(this.gl=a,this.timeLoad=this.timePrev=performance.now(),this.timeDelta=0,this.forceRender=!0,this.paused=!1,e.style.backgroundColor=i.backgroundColor||"rgba(1,1,1,0)",e.hasAttribute("data-fragment"))this.fragmentString=e.getAttribute("data-fragment");else if(e.hasAttribute("data-fragment-url")){var s=e.getAttribute("data-fragment-url");p.get(s,function(t,e,i){n.load(i,n.vertexString)})}if(e.hasAttribute("data-vertex"))this.vertexString=e.getAttribute("data-vertex");else if(e.hasAttribute("data-vertex-url")){var l=e.getAttribute("data-vertex-url");p.get(l,function(t,e,i){n.load(n.fragmentString,i)})}if(this.load(),this.program){var u=a.getAttribLocation(this.program,"a_texcoord");this.vbo.texCoords=a.createBuffer(),this.gl.bindBuffer(a.ARRAY_BUFFER,this.vbo.texCoords),this.gl.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),a.STATIC_DRAW),this.gl.enableVertexAttribArray(u),this.gl.vertexAttribPointer(u,2,a.FLOAT,!1,0,0);var h=a.getAttribLocation(this.program,"a_position");if(this.vbo.vertices=a.createBuffer(),this.gl.bindBuffer(a.ARRAY_BUFFER,this.vbo.vertices),this.gl.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),a.STATIC_DRAW),this.gl.enableVertexAttribArray(h),this.gl.vertexAttribPointer(h,2,a.FLOAT,!1,0,0),e.hasAttribute("data-textures")){var f=e.getAttribute("data-textures").split(",");for(var c in f)this.setUniform("u_tex"+c,f[c])}var d={x:0,y:0};document.addEventListener("mousemove",function(t){d.x=t.clientX||t.pageX,d.y=t.clientY||t.pageY},!1);var g=this;return this.setMouse({x:0,y:0}),function t(){g.nMouse>1&&g.setMouse(d),g.render(),g.forceRender=g.resize(),window.requestAnimationFrame(t)}(),this}}}return T(t,[{key:"destroy",value:function(){for(var t in this.animated=!1,this.isValid=!1,this.textures)t.destroy&&t.destroy();for(var e in this.textures={},this.attribs)this.gl.deleteBuffer(this.attribs[e]);this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.gl=null}},{key:"load",value:function(t,e){if(e&&(this.vertexString=e),t&&(this.fragmentString=t),this.animated=!1,this.nDelta=(this.fragmentString.match(/u_delta/g)||[]).length,this.nTime=(this.fragmentString.match(/u_time/g)||[]).length,this.nDate=(this.fragmentString.match(/u_date/g)||[]).length,this.nMouse=(this.fragmentString.match(/u_mouse/g)||[]).length,this.animated=this.nDate>1||this.nTime>1||this.nMouse>1,this.fragmentString.search(/sampler2D/g))for(var i=this.fragmentString.split("\n"),n=0;n<i.length;n++){var o=i[n].match(/uniform\s*sampler2D\s*([\w]*);\s*\/\/\s*([\w|\:\/\/|\.|\-|\_]*)/i);if(o){var a=o[2].split(".").pop().toLowerCase();o[1]&&o[2]&&("jpg"===a||"jpeg"===a||"png"===a||"ogv"===a||"webm"===a||"mp4"===a)&&this.setUniform(o[1],o[2])}if(i[n].match(/\s*void\s*main\s*/g))break}var s=r(this,this.vertexString,this.gl.VERTEX_SHADER),l=r(this,this.fragmentString,this.gl.FRAGMENT_SHADER);l?this.isValid=!0:(l=r(this,"void main(){\n\tgl_FragColor = vec4(1.0);\n}",this.gl.FRAGMENT_SHADER),this.isValid=!1);var u=function(t,e,i,r){for(var n=t.gl,o=n.createProgram(),a=0;a<e.length;++a)n.attachShader(o,e[a]);if(i)for(var s=0;s<i.length;++s)n.bindAttribLocation(o,r?r[s]:s,i[s]);return n.linkProgram(o),n.getProgramParameter(o,n.LINK_STATUS)?o:(R=n.getProgramInfoLog(o),console.log("Error in program linking:"+R),n.deleteProgram(o),null)}(this,[s,l]);this.gl.useProgram(u),this.gl.deleteShader(s),this.gl.deleteShader(l),this.program=u,this.change=!0,this.trigger("load",{}),this.forceRender=!0}},{key:"test",value:function(t,e,i){function r(){h.paused=a,(e||i)&&h.load(o,n)}var n=this.vertexString,o=this.fragmentString,a=this.paused,s=this.gl.getExtension("EXT_disjoint_timer_query"),l=s.createQueryEXT(),u=this.isValid;(e||i)&&(this.load(e,i),u=this.isValid,this.forceRender=!0,this.render()),this.paused=!0,s.beginQueryEXT(s.TIME_ELAPSED_EXT,l),this.forceRender=!0,this.render(),s.endQueryEXT(s.TIME_ELAPSED_EXT);var h=this;!function n(){h.forceRender=!0,h.render();var o=s.getQueryObjectEXT(l,s.QUERY_RESULT_AVAILABLE_EXT),a=h.gl.getParameter(s.GPU_DISJOINT_EXT);if(o&&!a){var f={wasValid:u,frag:e||h.fragmentString,vert:i||h.vertexString,timeElapsedMs:s.getQueryObjectEXT(l,s.QUERY_RESULT_EXT)/1e6};r(),t(f)}else window.requestAnimationFrame(n)}()}},{key:"loadTexture",value:function(t,e,i){var r=this;i||(i={}),"string"==typeof e?i.url=e:"object"===(void 0===e?"undefined":y(e))&&e.data&&e.width&&e.height?(i.data=e.data,i.width=e.width,i.height=e.height):"object"===(void 0===e?"undefined":y(e))&&(i.element=e),this.textures[t]?this.textures[t]&&(this.textures[t].load(i),this.textures[t].on("loaded",function(t){r.forceRender=!0})):(this.textures[t]=new S(this.gl,t,i),this.textures[t].on("loaded",function(t){r.forceRender=!0}))}},{key:"refreshUniforms",value:function(){this.uniforms={}}},{key:"setUniform",value:function(t){for(var e={},i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];e[t]=r,this.setUniforms(e)}},{key:"setUniforms",value:function(t){var e=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=[];for(var n in e){var o=e[n],a=void 0;if(i&&(n=i+"."+n),"number"==typeof o)r.push({type:"float",method:"1f",name:n,value:o});else if(Array.isArray(o)){if("number"==typeof o[0])1===o.length?r.push({type:"float",method:"1f",name:n,value:o}):o.length>=2&&o.length<=4?r.push({type:"vec"+o.length,method:o.length+"fv",name:n,value:o}):o.length>4&&r.push({type:"float[]",method:"1fv",name:n+"[0]",value:o});else if("string"==typeof o[0])r.push({type:"sampler2D",method:"1i",name:n,value:o});else if(Array.isArray(o[0])&&"number"==typeof o[0][0]){if(o[0].length>=2&&o[0].length<=4)for(a=0;a<o.length;a++)r.push({type:"vec"+o[0].length,method:o[a].length+"fv",name:n+"["+a+"]",value:o[a]})}else if("object"===y(o[0]))for(a=0;a<o.length;a++)r.push.apply(r,b(t(o[a],n+"["+a+"]")))}else"boolean"==typeof o?r.push({type:"bool",method:"1i",name:n,value:o}):"string"==typeof o?r.push({type:"sampler2D",method:"1i",name:n,value:o}):"object"===(void 0===o?"undefined":y(o))&&r.push.apply(r,b(t(o,n)))}return r}(t);for(var i in e)"sampler2D"===e[i].type?this.loadTexture(e[i].name,e[i].value[0]):(this.uniform(e[i].method,e[i].type,e[i].name,e[i].value),this.forceRender=!0)}},{key:"setMouse",value:function(t){var e=this.canvas.getBoundingClientRect();t&&t.x&&t.x>=e.left&&t.x<=e.right&&t.y&&t.y>=e.top&&t.y<=e.bottom&&this.uniform("2f","vec2","u_mouse",t.x-e.left,this.canvas.height-(t.y-e.top))}},{key:"uniform",value:function(t,e,i){this.uniforms[i]=this.uniforms[i]||{};for(var r=this.uniforms[i],n=arguments.length,o=Array(n>3?n-3:0),a=3;a<n;a++)o[a-3]=arguments[a];((function(t,e){return!(!t||!e)&&t.toString()!==e.toString()})(r.value,o)||this.change||void 0===r.location||void 0===r.value)&&(r.name=i,r.value=o,r.type=e,r.method="uniform"+t,r.location=this.gl.getUniformLocation(this.program,i),this.gl[r.method].apply(this.gl,[r.location].concat(r.value)))}},{key:"uniformTexture",value:function(t,e,i){void 0===this.textures[t]?this.loadTexture(t,e,i):(this.uniform("1i","sampler2D",t,this.texureIndex),this.textures[t].bind(this.texureIndex),this.uniform("2f","vec2",t+"Resolution",this.textures[t].width,this.textures[t].height),this.texureIndex++)}},{key:"resize",value:function(){if(this.width!==this.canvas.clientWidth||this.height!==this.canvas.clientHeight){var t=window.devicePixelRatio||1,e=Math.floor(this.gl.canvas.clientWidth*t),i=Math.floor(this.gl.canvas.clientHeight*t);return this.gl.canvas.width===e&&this.gl.canvas.height===i||(this.gl.canvas.width=e,this.gl.canvas.height=i,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,!0}return!1}},{key:"render",value:function(){if(this.visible=function(t){return t.getBoundingClientRect().top+t.height>0&&t.getBoundingClientRect().top<(window.innerHeight||document.documentElement.clientHeight)}(this.canvas),this.forceRender||this.animated&&this.visible&&!this.paused){var t=new Date,e=performance.now();for(var i in this.timeDelta=(e-this.timePrev)/1e3,this.timePrev=e,this.nDelta>1&&this.uniform("1f","float","u_delta",this.timeDelta),this.nTime>1&&this.uniform("1f","float","u_time",(e-this.timeLoad)/1e3),this.nDate&&this.uniform("4f","float","u_date",t.getFullYear(),t.getMonth(),t.getDate(),3600*t.getHours()+60*t.getMinutes()+t.getSeconds()+.001*t.getMilliseconds()),this.uniform("2f","vec2","u_resolution",this.canvas.width,this.canvas.height),this.texureIndex=0,this.textures)this.uniformTexture(i);this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.trigger("render",{}),this.change=!1,this.forceRender=!1}}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"version",value:function(){return"0.0.25"}}]),t}();return window.addEventListener("load",function(){!function(){var t=document.getElementsByClassName("glslCanvas");if(t.length>0){window.glslCanvases=[];for(var e=0;e<t.length;e++){var i=new L(t[e]);i.isValid&&window.glslCanvases.push(i)}}}()}),L});
"use strict";class UI{constructor(){this.modal=null,this.canvas=null,this.shader=null,this.currentScroll=[0,0],this.initHeroShader(),this.initMetaballs(),this.initModal(),document.querySelector(".show-more").addEventListener("click",e=>{document.querySelector(".about.slide").scrollIntoView({behavior:"smooth"})})}initHeroShader(){const e=document.querySelector(".hero canvas");this.canvas=e,this.maximizeHeroCanvasSize(e);const t=new GlslCanvas(this.canvas);t.uniformTexture("u_tex0","img/shader/texture_1.jpg",{repeat:!0,filtering:"mipmap"}),t.uniformTexture("u_tex1","img/shader/8x8-bayer.png"),this.shader=t,window.addEventListener("resize",t=>{this.maximizeHeroCanvasSize(e)})}initMetaballs(){const e=document.querySelector(".about canvas");e.width=500,e.height=400,new GlslCanvas(e).uniformTexture("u_tex0","img/shader/8x8-bayer.png")}maximizeHeroCanvasSize(e){e.style.width="100%",e.width=e.offsetWidth,e.height=window.innerHeight}initModal(){fetch("data/projects.json").then(e=>e.json()).then(e=>{this.modal=new Modal(e)})}}document.addEventListener("DOMContentLoaded",e=>{const t=new UI;console.log(t)});
class Modal{constructor(t){this.$modal=document.querySelector("article.modal"),this.$heading=this.$modal.querySelector("h1"),this.$content=this.$modal.querySelector(".description"),this.$image=this.$modal.querySelector("img"),this.$close=this.$modal.querySelector(".close"),this.$togglers=document.querySelectorAll("[data-modal]"),this.projects=t,this.initModalEvents()}toggleModal(){document.body.classList.toggle("open")}isModalOpen(){return document.body.classList.contains("open")}loadContent(t){if(!this.projects[t])throw new Error("Project does not exists, check if key exists.");this.$heading.textContent=this.projects[t].title,this.$image.src=this.projects[t].image_path,this.$content.innerHTML=this.formatBody(this.projects[t].description)}formatBody(t){return t.split("\r").map(t=>`<p>${t}</p>`).join("")}initModalEvents(){this.addProjectItemEvents(),this.addCloseButtonEvent(),this.addKeyboardEvent(),this.addBodyClickToggleEvent()}addBodyClickToggleEvent(){document.body.addEventListener("click",t=>{t.target.classList.contains("_close")&&this.toggleModal()})}addProjectItemEvents(){this.$togglers.forEach(t=>{t.addEventListener("click",t=>{this.toggleModal();try{const e=this.findParentByClass(t.target,"project");this.loadContent(e.dataset.modal)}catch(t){console.error(t.message)}})})}addCloseButtonEvent(){this.$close.addEventListener("click",t=>{this.toggleModal()})}addKeyboardEvent(){document.addEventListener("keyup",t=>{"Escape"==t.key&&this.toggleModal()})}findParentByClass(t,e){return!!t.parentNode&&(t.classList.contains(e)?t:t.parentNode&&this.findParentByClass(t.parentNode,e))}}